<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ ç”Ÿæ—¥å¿«ä¹ï¼ âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #9370DB; /* ä»™æ°”é£˜é£˜çš„æ·¡ç´«è‰² (MediumPurple) */
            --light-purple: #B19CD9; /* æµ…ç´«è‰² */
            --dark-purple: #4B0082;  /* æ·±ç´«è‰² (Indigo) */
            --heart-color: #FF6B6B; /* æ˜¾çœ¼çš„çˆ±å¿ƒé¢œè‰² */
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-color: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            /* æ ¸å¿ƒä¿®æ”¹ï¼šç§»é™¤è¿™é‡Œçš„ cursor: none;ï¼Œäº¤ç”± JS åŠ¨æ€æ§åˆ¶ */
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 80%, var(--dark-purple) 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Ma Shan Zheng', cursive;
            color: var(--text-color);
            perspective: 1000px;
        }

        /* -------------------------------------------------- */
        /* Z-index è°ƒæ•´åŒºåŸŸ */
        /* -------------------------------------------------- */

        #starfield {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
        }
        #fireworks-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; 
        }
        #snow-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; overflow: hidden;
        }
        #heart-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 60;
        }

        /* 3D å¡ç‰‡å®¹å™¨ */
        .card-container {
            position: relative;
            z-index: 10; 
            width: 500px; 
            max-width: 95%; 
            padding: 40px;
            transform-style: preserve-3d;
            transition: transform 0.1s;
        }

        /* -------------------------------------------------- */
        /* è‡ªå®šä¹‰çˆ±å¿ƒå…‰æ ‡æ ·å¼ (ç¾åŒ–) */
        /* -------------------------------------------------- */
        #custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 18px; /* ç•¥å¾®ç¼©å° */
            height: 18px;
            z-index: 100;
            transform: translate(-50%, -50%) rotate(-45deg); 
            pointer-events: none; 
            transition: transform 0.05s ease-out, opacity 0.3s;
        }
        
        .cursor-heart {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: var(--heart-color); 
            border-radius: 4px; /* å‡å°‘åœ†è§’ï¼Œæ›´åƒçˆ±å¿ƒåº•éƒ¨ */
            box-shadow: 0 0 5px var(--primary-color); /* æ·»åŠ ç´«è‰²å…‰æ™• */
        }
        .cursor-heart::before,
        .cursor-heart::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%; /* ä¿æŒåœ†å½¢ */
            background-color: var(--heart-color);
        }
        /* å·¦ä¸Šè§’åŠåœ† */
        .cursor-heart::before {
            top: -50%;
            left: 0;
        }
        /* å³ä¸Šè§’åŠåœ† */
        .cursor-heart::after {
            top: 0;
            left: 50%;
        }

        /* -------------------------------------------------- */
        /* å¯åŠ¨é¡µæ ·å¼ä¿®æ­£ */
        /* -------------------------------------------------- */
        .start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #090a0f;
            z-index: 100; display: flex; flex-direction: column; justify-content: center;
            align-items: center; transition: opacity 1s ease;
            cursor: default; /* å¯åŠ¨é¡µæ˜¾ç¤ºåŸç”Ÿé¼ æ ‡ */
        }
        .btn-glow {
            /* ... (ä¿æŒä¸å˜) ... */
            cursor: pointer; /* ç¡®ä¿æŒ‰é’®ä¸Šæœ‰æŒ‡é’ˆå˜åŒ– */
        }


        /* -------------------------------------------------- */
        /* é¼ æ ‡çˆ±å¿ƒé£˜æ•£æ•ˆæœæ ·å¼ï¼ˆä¿æŒä¸å˜ï¼‰ */
        /* -------------------------------------------------- */

        .heart {
            position: absolute;
            width: 15px; 
            height: 15px;
            background-color: var(--primary-color);
            transform: rotate(-45deg);
            pointer-events: none;
            opacity: 0;
            z-index: 60;
            transition: transform 0.5s, opacity 0.5s;
        }
        .heart::before,
        .heart::after {
            content: "";
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: var(--primary-color);
        }
        .heart::before { top: -7.5px; left: 0; }
        .heart::after { top: 0; left: 7.5px; }

        @keyframes fadeOutUp {
            0% { transform: translate(0, 0) scale(1) rotate(-45deg); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0) rotate(-45deg); opacity: 0; }
        }
        
        /* -------------------------------------------------- */
        /* å…¶ä»–æ ·å¼ï¼ˆä¿æŒä¸å˜ï¼‰ */
        /* -------------------------------------------------- */
        
        @media (max-width: 768px) {
            .card-container { width: 95%; padding: 10px; }
        }
        .snowflake { position: absolute; background-color: #fff; border-radius: 50%; opacity: 0; animation: fall linear forwards; }
        @keyframes fall {
            0% { transform: translateY(-100px) translateX(0px); opacity: 0; }
            10% { opacity: 0.9; }
            90% { opacity: 0.9; }
            100% { transform: translateY(105vh) translateX(var(--drift)); opacity: 0; }
        }
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-radius: 20px; padding: 30px;
            box-shadow: 0 25px 45px rgba(0,0,0,0.2); text-align: center; transform: translateZ(20px);
            display: none; opacity: 0; transition: opacity 1.5s ease;
        }
        .photo-wrapper {
            width: 150px; height: 150px; margin: 0 auto 20px; border-radius: 50%; padding: 5px;
            background: linear-gradient(45deg, var(--light-purple), var(--primary-color)); 
            box-shadow: 0 0 20px var(--primary-color), 0 0 30px var(--dark-purple); 
            transform: translateZ(50px);
        }
        .photo-wrapper img {
            width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid rgba(255,255,255,0.8);
        }
        h1 {
            font-family: 'Cinzel', serif; font-size: 2.5em; margin-bottom: 15px;
            background: linear-gradient(to right, #fff, var(--primary-color)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            text-shadow: 0 0 10px rgba(147, 112, 219, 0.5); 
            transform: translateZ(40px);
        }
        .message-box {
            font-size: 1.3em; line-height: 1.6; min-height: 120px; text-align: left;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); transform: translateZ(30px); margin-bottom: 20px;
        }
        .cursor { display: inline-block; width: 2px; background-color: #fff; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .music-control {
            font-size: 0.8em; color: rgba(255,255,255,0.6); cursor: pointer; transform: translateZ(30px);
            margin-top: 10px; border: 1px solid rgba(255,255,255,0.3); padding: 5px 15px;
            border-radius: 20px; display: inline-block; transition: 0.3s;
        }
        .music-control:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-glow {
            padding: 15px 40px; font-size: 1.5rem; background: transparent; color: #fff;
            border: 2px solid var(--primary-color); border-radius: 50px; cursor: pointer;
            font-family: 'Cinzel', serif; position: relative; transition: 0.5s;
            box-shadow: 0 0 10px var(--primary-color), 0 0 40px var(--light-purple);
        }
        .btn-glow:hover {
            background: var(--primary-color); color: #000;
            box-shadow: 0 0 20px var(--primary-color), 0 0 60px var(--light-purple);
        }
    </style>
</head>
<body>

    <canvas id="starfield"></canvas>
    <canvas id="fireworks-overlay"></canvas>
    <div id="snow-container"></div> 
    <div id="heart-container"></div>
    
    <div id="custom-cursor">
        <div class="cursor-heart"></div>
    </div>
    
    <div class="start-overlay" id="startOverlay">
        <button class="btn-glow" onclick="initPage()">ENTER THE GALAXY</button>
        <p style="margin-top:20px; color:rgba(255,255,255,0.5); font-size: 0.9em;">(è¯·å¼€å¯å£°éŸ³ä½“éªŒæœ€ä½³æ•ˆæœ)</p>
    </div>

    <div class="card-container" id="cardContainer">
        <div class="glass-card" id="mainCard">
            <div class="photo-wrapper">
                <img src="./source/cake.webp" alt="Her">
            </div>
            <h1>Happy Birthday</h1>
            <div class="message-box">
                <span id="typed-text"></span><span class="cursor">|</span>
            </div>
            <div class="music-control" id="musicControl" onclick="toggleMusic()">ğŸµ Music: On/Off</div>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="./source/ä¸ƒé‡Œé¦™.mp3" type="audio/mpeg">
    </audio>

    <script>
        /**
         * --------------------------------------------------
         * é…ç½®åŒºåŸŸ
         * --------------------------------------------------
         */
        const CONFIG = {
            text: "ä»™æ°”é£˜é£˜çš„ é‚“ä½³ å®å®ï¼š\n\nç”Ÿæ—¥å¿«ä¹ï¼åœ¨è¿™ä¹ˆä¸ªç‰¹æ®Šçš„æ—¥å­é‡Œï¼Œå¾ˆæŠ±æ­‰æˆ‘æ²¡æœ‰èƒ½å¤Ÿé™ªåœ¨ä½ èº«è¾¹ã€‚\n\nçˆ±ä¸Šä½ æ˜¯æˆ‘ä»Šå¹´é‡åˆ°çš„æœ€ç¾å¥½çš„äº‹æƒ…ï¼ \n ä½ èƒ½èµ°è¿›æˆ‘çš„ç”Ÿæ´»ï¼Œè¿™è®©æˆ‘å……æ»¡äº†å¸Œæœ›å’ŒåŠ¨åŠ›ã€‚ \n\næˆ‘å¾ˆæœŸå¾…æˆ‘ä»¬ä¸‹ä¸€æ¬¡çš„ç›¸èšï¼Œ\næ— è®ºæ˜¯å›½å†…è¿˜æ˜¯å›½å¤–ï¼Œæˆ–æ˜¯ç°å®æˆ–æ˜¯æ¢¦é‡Œã€‚\n\nä½ æ˜¯æˆ‘çš„å¥³å­©ï¼Œæ˜¯æˆ‘æ°¸è¿œçš„åçˆ±ï¼Œ\næå‘ˆæ™ºâ¤ï¸",
            typeSpeed: 180
        };

        /**
         * --------------------------------------------------
         * CUSTOM CURSOR LOGIC (ç¾åŒ–å’Œåˆ‡æ¢é€»è¾‘)
         * --------------------------------------------------
         */
        const customCursor = document.getElementById('custom-cursor');
        
        // å®æ—¶æ›´æ–°å…‰æ ‡ä½ç½®
        document.addEventListener('mousemove', (e) => {
            customCursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px) rotate(-45deg)`;
        });

        // é»˜è®¤éšè—è‡ªå®šä¹‰å…‰æ ‡ï¼Œåªåœ¨ä¸»é¡µæ˜¾ç¤º
        customCursor.style.opacity = '0';
        
        // ç›‘å¬è¿›å…¥/ç¦»å¼€ body åŒºåŸŸï¼Œä»¥ç¡®ä¿å…‰æ ‡åœ¨è¾¹ç•Œéšè—
        document.body.addEventListener('mouseleave', () => {
             // ä»…å½“ body çš„å…‰æ ‡è¢«éšè—æ—¶ï¼Œæ‰éšè—è‡ªå®šä¹‰å…‰æ ‡
            if (document.body.style.cursor === 'none') {
                 customCursor.style.opacity = '0';
            }
        });
        document.body.addEventListener('mouseenter', () => {
            if (document.body.style.cursor === 'none') {
                customCursor.style.opacity = '1';
            }
        });

        /**
         * --------------------------------------------------
         * MOUSE HEART LOGIC 
         * --------------------------------------------------
         */

        const heartContainer = document.getElementById('heart-container');

        function createHeart(x, y) {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            
            heart.style.left = `${x - 7.5}px`; 
            heart.style.top = `${y - 7.5}px`;

            const dx = (Math.random() - 0.5) * 150; 
            const dy = -100 - Math.random() * 150; 

            heart.style.setProperty('--dx', `${dx}px`);
            heart.style.setProperty('--dy', `${dy}px`);
            
            const duration = Math.random() * 1.5 + 1.5; 
            heart.style.animation = `fadeOutUp ${duration}s ease-out forwards`;

            heartContainer.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, duration * 1000);
        }

        // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼ˆæŒç»­æ€§çˆ±å¿ƒï¼‰
        document.addEventListener('mousemove', (e) => {
            if (document.body.style.cursor === 'none' && Math.random() < 0.1) {
                createHeart(e.clientX, e.clientY);
            }
        });
        
        // ç›‘å¬ç‚¹å‡»äº‹ä»¶ï¼ˆçˆ†å‘æ€§çˆ±å¿ƒï¼‰
        document.addEventListener('click', (e) => {
            if (document.body.style.cursor === 'none') {
                for(let i=0; i<5; i++) {
                    createHeart(e.clientX, e.clientY);
                }
            }
        });


        /**
         * --------------------------------------------------
         * æ ¸å¿ƒé€»è¾‘ (Canvas & åŠ¨ç”»)
         * --------------------------------------------------
         */

        function getRandomColor() {
            const colors = ['#9370DB', '#B19CD9', '#E0BBE4', '#FFC72C', '#FF6B6B', '#8BE9FD', '#FFFFFF']; 
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // --------------------------------------------------
        // CANVAS SETUP
        // --------------------------------------------------
        
        const starCanvas = document.getElementById('starfield');
        const starCtx = starCanvas.getContext('2d');
        const fireworkCanvas = document.getElementById('fireworks-overlay');
        const fireworkCtx = fireworkCanvas.getContext('2d');

        let width, height;
        let particles = []; 
        let fireworks = []; 

        function resize() {
            width = starCanvas.width = fireworkCanvas.width = window.innerWidth;
            height = starCanvas.height = fireworkCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --------------------------------------------------
        // PARTICLES & ANIMATION LOOPS (ä¿æŒä¸å˜)
        // --------------------------------------------------
        
        class Star {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2;
                this.brightness = Math.random();
            }
            update() {
                this.brightness += Math.random() * 0.05 - 0.025;
                if(this.brightness < 0) this.brightness = 0;
                if(this.brightness > 1) this.brightness = 1;
            }
            draw() {
                starCtx.fillStyle = `rgba(255, 255, 255, ${this.brightness})`;
                starCtx.beginPath();
                starCtx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                starCtx.fill();
            }
        }
        class FireworkParticle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 6 + 2; 
                this.vx = Math.cos(angle) * velocity;
                this.vy = Math.sin(angle) * velocity;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.01; 
                this.gravity = 0.08; this.friction = 0.98; 
            }
            update() {
                this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity; 
                this.x += this.vx; this.y += this.vy; this.life -= this.decay;
            }
            draw() {
                fireworkCtx.globalAlpha = this.life; fireworkCtx.fillStyle = this.color;
                fireworkCtx.beginPath(); fireworkCtx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                fireworkCtx.fill(); fireworkCtx.globalAlpha = 1;
            }
        }
        for(let i=0; i<200; i++) particles.push(new Star());

        function animateStars() {
            starCtx.fillStyle = 'rgba(15, 12, 41, 0.2)'; starCtx.fillRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
        }
        function animateFireworks() {
            fireworkCtx.fillStyle = 'rgba(0, 0, 0, 0.1)'; fireworkCtx.fillRect(0, 0, width, height);
            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update(); fireworks[i].draw();
                if (fireworks[i].life <= 0) fireworks.splice(i, 1);
            }
        }
        function animate() {
            animateStars(); animateFireworks();  requestAnimationFrame(animate);
        }
        function launchFirework(x, y) {
            const color = getRandomColor();
            const numParticles = Math.floor(Math.random() * 40) + 80; 
            for(let i=0; i<numParticles; i++) {
                fireworks.push(new FireworkParticle(x, y, color));
            }
            starCtx.fillStyle = `rgba(${parseInt(color.slice(1,3), 16)}, ${parseInt(color.slice(3,5), 16)}, ${parseInt(color.slice(5,7), 16)}, 0.4)`;
            starCtx.fillRect(0, 0, width, height);
        }
        function startFullsreenFireworks() {
            setInterval(() => {
                const randomX = Math.random() * width;
                const randomY = height * (0.25 + Math.random() * 0.5); 
                launchFirework(randomX, randomY);
            }, 400); 
        }
        const snowContainer = document.getElementById('snow-container');
        function createSnowflake() {
            const snowflake = document.createElement('div'); snowflake.classList.add('snowflake');
            const size = Math.random() * 8 + 4; const duration = Math.random() * 15 + 15; 
            const driftAmount = (Math.random() - 0.5) * 400; const delay = Math.random() * 5; 
            const startX = Math.random() * window.innerWidth; 
            snowflake.style.width = `${size}px`; snowflake.style.height = `${size}px`;
            snowflake.style.left = `${startX}px`; snowflake.style.animationDuration = `${duration}s`;
            snowflake.style.animationDelay = `${delay}s`; snowflake.style.setProperty('--drift', `${driftAmount}px`); 
            snowContainer.appendChild(snowflake);
            setTimeout(() => { snowflake.remove(); }, (duration + delay) * 1000);
        }
        function startSnowfall() {
            setInterval(createSnowflake, 150);
        }

        // --------------------------------------------------
        // INITIALIZATION & UI
        // --------------------------------------------------

        // 3D è§†å·®æ•ˆæœ (Parallax Tilt) 
        const container = document.getElementById('cardContainer');
        document.addEventListener('mousemove', (e) => {
            if (window.innerWidth < 768) return; 
            const xAxis = (window.innerWidth / 2 - e.pageX) / 25;
            const yAxis = (window.innerHeight / 2 - e.pageY) / 25;
            container.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
        });
        document.addEventListener('mouseleave', () => {
            container.style.transform = `rotateY(0deg) rotateX(0deg)`;
            container.style.transition = 'transform 0.5s ease';
        });
        document.addEventListener('mouseenter', () => {
            container.style.transition = 'none';
        });


        function initPage() {
            const overlay = document.getElementById('startOverlay');
            const card = document.getElementById('mainCard');
            const music = document.getElementById('bgMusic');
            const musicControl = document.getElementById('musicControl');

            // æ ¸å¿ƒä¿®æ”¹ 2: å¯åŠ¨ä¸»é¡µé€»è¾‘
            document.body.style.cursor = 'none'; // éšè—åŸç”Ÿé¼ æ ‡
            customCursor.style.opacity = '1';    // æ˜¾ç¤ºè‡ªå®šä¹‰å…‰æ ‡

            music.play().then(() => {
                musicControl.textContent = 'ğŸµ Music: Playing';
            }).catch(error => {
                musicControl.textContent = 'âš ï¸ Music: Click to play';
                console.error("éŸ³ä¹æ’­æ”¾å¤±è´¥ (æµè§ˆå™¨é™åˆ¶)", error);
            });
            
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                card.style.display = 'block';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    startTypeWriter(); 
                }, 50);
            }, 1000); 

            if (!window.animationRunning) {
                animate(); 
                window.animationRunning = true;
            }
            startSnowfall();     
            startFullsreenFireworks(); 
        }

        function startTypeWriter() {
            let i = 0;
            const textElement = document.getElementById('typed-text');
            
            function type() {
                if (i < CONFIG.text.length) {
                    const char = CONFIG.text.charAt(i);
                    textElement.innerHTML += char === '\n' ? '<br>' : char;
                    i++;
                    setTimeout(type, CONFIG.typeSpeed);
                } else {
                    document.querySelector('.cursor').style.display = 'none';
                }
            }
            type();
        }

        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            const musicControl = document.getElementById('musicControl');
            if (music.paused) {
                music.play().then(() => {
                     musicControl.textContent = 'ğŸµ Music: Playing';
                }).catch(() => {
                     musicControl.textContent = 'âš ï¸ Music: Play failed';
                });
            } else {
                music.pause();
                musicControl.textContent = 'ğŸµ Music: Paused';
            }
        }
    </script>
</body>
</html>